# You may edit this makefile as long as you keep these original 
# target names defined.

NAME=mat
DIST_DIR=mat-@MAT_VERSION@

DIST_FILE=mat-@MAT_VERSION@.tar.gz

-include Makefile.conf

include Makefile.defaults

srcdir = .
top_srcdir = @top_srcdir@
VPATH = @srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@
top_builddir = .

# Directories of sub-projects in the build order.
SUBDIRS=libmat

# Directories to be installed.
SUBDIRS_INSTALL=@SUBDIRS_INSTALL@

# Build executables for all mains defined by the project.
all clean::
	$(MAKE) -C libmat $@

install::
	$(MAKE) -C libmat $@
	$(ALR) exec -- gprinstall --prefix=$(DESTDIR)${prefix} -p -m --mode=usage -P mat
	cd matl && $(ALR) exec -- gprinstall --prefix=$(DESTDIR)${prefix} -p -m --mode=usage -P matl

build:: mat

mat:
	$(BUILD_COMMAND) $(GPRFLAGS) $(MAKE_ARGS)

test::
	cd regtests && $(BUILD_COMMAND) $(GPRFLAGS) $(MAKE_ARGS)
	bin/mat_harness

force:

# Clean, then build executables for all mains defined by the project.
rebuild: clean build

dist::
	rm -f $(DIST_FILE)
	git archive -o $(DIST_DIR).tar --prefix=$(DIST_DIR)/ HEAD
	gzip $(DIST_DIR).tar

# Development targets that requires ayacc and aflex to be installed.
# Do not call these unless you modify the lex/yacc grammar.
parser:	
	cd src/parser && \
	   ayacc -k -C -E -n 256 -v -e .ada mat-expressions-parser.y && \
	   gnatchop -w mat-expressions-parser.ada && \
	   rm -f mat-expressions-parser.ada
	-rm -f src/parser/mat-expressions-lexer_io.ads
	-rm -f src/parser/mat-expressions-lexer_io.adb
	-rm -f src/parser/mat-expressions-parser.verbose

lexer:
	cd src/parser; \
	aflex -ms mat-expressions-lexer.l
	cd src/parser && \
	  gnatchop -w mat-expressions-lexer.ada && \
	  rm -f mat-expressions-lexer.ada
